<html>
	<head>
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
		</style>
	</head>
	<body>
		<script src="three.min.js"></script>
		<script src="OrbitControls.js"></script>
		<script src="mountain.js"></script>
		<script src="solluna.js"></script>
		<script src="tree.js"></script>
		<script>
			const width = 400; const length = 400;
			var SKY;

			var renderer = new THREE.WebGLRenderer({antialias:true});
			renderer.setSize( window.innerWidth, window.innerHeight );
			renderer.setAnimationLoop( drawFrame );
			document.body.appendChild( renderer.domElement );

			var scene = new THREE.Scene();
			scene.background = new THREE.Color( 0x101010 );
			//scene.fog = new THREE.Fog( 0x101010, 10, 100 );

			var aspect = window.innerWidth/window.innerHeight;
			var camera = new THREE.PerspectiveCamera( 100, aspect );
			camera.position.set( 150, 250, 200 );

			var controls = new THREE.OrbitControls(camera, renderer.domElement);
			controls.enableDamping = true;
			controls.dampingFactor = 0.1;
			controls.maxPolarAngle = Math.PI / 2;
			controls.rotateSpeed = 0.2;
			
			var baseLoader = new THREE.TextureLoader().load('/Resources/snow/snow.jpg');
			var base = new THREE.Mesh(
				new THREE.PlaneGeometry( width, length ),
				new THREE.MeshPhongMaterial( {map: baseLoader} )
			);
			base.lookAt( new THREE.Vector3( 0, 1, 0 ) );
			scene.add( base );
			
			createMountain();
			createTree(20);
			createSky();
			createSolluna();

			function drawFrame()
			{
				SKY.rotation.x += 0.001;
				controls.update();
		
				renderer.render( scene, camera );
			}

			// // // // // // // // // //

			function createMountain() 
			{
				var mountain_1 = createMountainTerrain(width / 5, length * 1.4);
        		mountain_1.position.set(width / 2 + width / 10, 0, 0);
				mountain_1.receiveShadow = false;
				mountain_1.castShadow = false; 
       			scene.add(mountain_1);

				var mountain_2 = createMountainTerrain(width / 5, length * 1.4);
        		mountain_2.position.set(- width / 2 - width / 10, 0, 0);
				mountain_2.receiveShadow = false;
				mountain_2.castShadow = false; 
       			scene.add(mountain_2);

				var mountain_3 = createMountainTerrain(width * 1.4, length / 5);
        		mountain_3.position.set(0, 0, length / 2 + length / 10);
				mountain_3.receiveShadow = false;
				mountain_3.castShadow = false; 
       			scene.add(mountain_3);

				var mountain_4 = createMountainTerrain(width * 1.4, length / 5);
        		mountain_4.position.set(0, 0, - length / 2 - length / 10);
				mountain_4.receiveShadow = false;
				mountain_4.castShadow = false; 
       			scene.add(mountain_4);
			}

			function createTree(count) {
				const xPositions = [160, 170, 180];
				const zPositions = [];

				for (let z = -190; z <= 190; z += 20) {
					if (z < -50 || z > 50) {
						zPositions.push(z);
					}
				}

				for (let i = 0; i < count; i++) {
					const x = xPositions[Math.floor(Math.random() * xPositions.length)];

					const zIndex = i % zPositions.length;
					const z = zPositions[zIndex];

					const size = 0.7 + Math.random() * (1.2 - 0.7);
					const tree = growTree(size);
					tree.position.set(x, 0, z);
					scene.add(tree);
				}
			}

			function createSolluna()
			{
				var directionalLight;

				var sun = createRotatingSphere('sun', 100, 0, 900, 30);
				directionalLight = new THREE.DirectionalLight(0xffaf00, 0.3);
				sun.add(directionalLight);
				directionalLight = new THREE.DirectionalLight(0xffffff, 1); 
				sun.add(directionalLight);
				scene.add(sun); 

				moon = createRotatingSphere('moon', 100, 0, 900, 30);
				directionalLight = new THREE.DirectionalLight(0x003f70, 0.3);
				moon.add(directionalLight);
				directionalLight = new THREE.DirectionalLight(0xffffff, 1); 
				moon.add(directionalLight);
				scene.add(moon);

				directionalLight.castShadow = true;
			}
			
			function createSky()
			{
				var sky = new THREE.TextureLoader().load('Resources/sky/yale8.jpg');
				sky.repeat = new THREE.Vector2(3,3);
				sky.offset = new THREE.Vector2(0,0);
				sky.wrapS = THREE.RepeatWrapping;
				sky.wrapT = THREE.RepeatWrapping;

				SKY = new THREE.Mesh(
					new THREE.SphereGeometry(1000, 64, 64),
					new THREE.MeshPhongMaterial({map: sky, side: THREE.DoubleSide})
				);

				scene.add(SKY);
			}
		</script>
	</body>
</html>